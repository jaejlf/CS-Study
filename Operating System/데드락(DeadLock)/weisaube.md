# 데드락

## 📌 A. 데드락(Deadlock, 교착상태)란?

> 둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다릴 때 무한 대기에 빠지는 상황

<br/>

## 📌 B. 데드락의 발생조건

<br/>

- 상호배제
  - 한 번에 프로세스 하나만 해당 자원을 사용할 수 있다. 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 한다.
- **점유 대기**
  - 자원을 최소한 하나 보유하고, 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 한다.
- **비선점**
  - 이미 할당된 자원을 강제로 빼앗을 수 없다(비선점).
- **순환 대기**
  - 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다.

<br/>

## 📌 C. 데드락의 해결법

<br/>

👉 **예방**, **회피**, **탐지&회복**

1. 교착상태가 발생하지 않도록 **예방(prevention)**하기

2. 교착상태 발생 가능성을 인정하면서도 적절하게 **회피(avoidance)**하기

3. 교착상태 발생을 허용하지만 데드락을 **탐지(detection)**하여, 교착상태에서 **회복**하기

<br/>

### ① 데드락의 예방

> 교착상태의 발생조건 4가지 중 하나라도 발생하지 않게 하는 것<br/>
> 즉, 각각의 조건을 방지하여 교착상태 발생 가능성을 차단

<br/>

시스템의 처리량이나 효율성을 떨어트리는 단점이 발생할 수 있음

- 자원의 상호 배제 조건 방지
  - 한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 하기
  - 추후 동기화 관련 문제가 발생할 수 있음
- 점유 대기 조건 방지
  - 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구한 뒤 허용할 때까지 작업을 보류하여 나중에 또 다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 하기
- 비선점 조건 방지
  - 이미 다른 프로세스에게 할당된 자원에 대한 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 하기
- 순환 대기 조건 방지
  - 자원을 순환 형태로 대기하지 않도록 일정한 한 쪽 방향으로만 자원을 요구할 수 있도록 하기

<br/>

### ② 교착상태 회피

<br/>

- 시스템의 프로세스들이 요청하는 모든 자원을 교착상태 없이 모두에게 할당해 줄 수 있는 경우 안정 상태(safe state)에 있다고 함

- 이처럼 특정한 순서로 프로세스들에게 자원을 할당, 실행 및 종료 등의 작업을 할 때 교착상태가 발생하지 않는 순서를 찾을 수 있다면, 그것을 안정 순서(safe sequence)라고 함

- 불안정 상태(unsafe state)는 안정 상태가 아닌 상황으로, 교착상태 발생 가능성이 있는 상황임. 또한 교착상태는 불안정 상태일 때 발생할 수 있으므로, 불안정 상태가 교착 상태보다 더 큰 집합

<br/>

#### ✔️ 회피 알고리즘

> 자원을 할당한 후에도 시스템이 항상 safe state에 있을 수 있도록 할당을 허용하자는 것이 특징 ex) 은행원 알고리즘

<br/>

#### ✔️ 은행원 알고리즘

> 어떤 자원의 할당을 허용하는지에 관한 여부를 결정 전에, 미리 결정된 모든 자원들의 최대 가능한 할당량을 가지고 시뮬레이션하여 safe state에 들 수 있는지 여부를 검사

<br/>

### ③ 교착상태 탐지 및 회복

<br/>

#### ✔️ 탐지 기법

> 시스템에 교착상태가 발생했는지 여부를 탐색

- 은행원 알고리즘 방식과 유사하게 현재 시스템의 자원 할당 상태를 기반으로 파악

- 자원 할당 그래프를 통해 탐지하는 방법도 존재

<br/>

#### 회복 기법

> 탐지 기법을 통해 교착 상태를 발견한 후, 순환 대기에서 벗어나 교착상태에서 회복하기 위한 방법

<br/>

1. 단순히 프로세스를 1개 이상 중단시키는 방법
   1. 교착 상태에 빠진 모든 프로세스 중단
      - 프로세스를 모두 일시에 중단하여 부분적인 결과가 폐기될 수 있는 부작용 존재
   2. 프로세스를 하나씩 중단시킬 때마다 탐지 기법으로 교착상태를 찾으면서 회복
      - 매번 탐지 알고리즘 수행으로 부담되는 작업
2. 자원 선점하기
   1. 프로세스에 할당된 자원을 선점하여 교착 상태를 해결할 때까지 그 자원을 다른 프로세스에 할당해 주는 방법

## 📌 D. 참고자료

🔗 https://chanhuiseok.github.io/posts/cs-2/
