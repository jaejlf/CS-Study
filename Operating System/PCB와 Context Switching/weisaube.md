# PCB와 컨텍스트 스위칭(PCB & Context Switching)

## A. 컨텍스트

> CPU가 해당 프로세스를 실행하기 위한 해당 프로세스의 정보들

<br>

- 컨텍스트는 프로세스의 PCB(Process Control Block)에 저장된다

<br>

## B. PCB(Process Control Block), 프로세스 제어 블록

> 운영체제에 필요한 프로세스의 모든 정보들이 들어 있다

<br>

- 스케쥴링, 자원 할당, 인터럽트 처리, 성능 측정과 분석에 대한 모듈들 포함하여 운영체제의 모든 모듈에 의해 읽혀지고 수정될 수 있다.<br>
  => PCB는 **운영체제의 상태**를 정의한다고 볼 수 있다
- 운영체제에 의해 생성되어 관리된다.
- 주 역할: 수행 프로세스를 인터럽트 한 후 **나중에 그 인터럽트가 발생되지 않은 것처럼** 프로세스 수행을 제게할 수 있도록 충분한 정보 유지<br> => 컨텍스트 스위칭과 연관!
- 운영체제로 하여금 다수의 프로세스 지원하고 멀티프로세싱 제공할 수 있도록 하는 주요 도구

<br>

### PCB에 저장되는 정보들

- PCB에 저장되는 정보들

  - 식별자: 프로세스를 구별해주는 유일한 식별자
  - 상태: 프로세스가 수행 중이면 `수행(running)` 상태
  - 우선순위: 다른 프로세스들에 대한 상대적인 우선순위
  - 프로그램 카운터(PC): 프로그램에서 다음에 수행될 명령어의 주소
  - 메모리 포인터: 프로세스와 연계된 프로그램 코드 및 데이터, 다른 프로세스들과 함꼐 공유되는 메모리 블록들에 대한 포인터 포함
  - 문맥 데이터(context data): 프로세스가 수행 중일 때, 처리기의 레지스터에 존재하는 데이터
  - 입출력 상태 정뵈 미해결 입출력 요청, 프로세스에 할당된 입출력 장치(ex. 테이프 드라이브), 프로세스에 의해 사용 중인 파일들의 리스트
  - 어카운팅 정보(accounting information): 사용된 처리기 시작 및 클록 시간, 시간 제한, 계정 정보(accounting number) 등

  <br>

<img src="https://images.velog.io/images/chappi/post/3a88138f-5bc8-4756-8f39-955b89a560a2/1.jpg">

<br>

## C. 컨텍스트 스위칭(Context Switching, 문맥 교환)

<br>

> 현재 진행하고 있는 프로세스의 상태를 PCB에 저장하고 다음 진행할 프로세스의 정보를 PCB에서 읽어 적용하는 과정

<br>

### 컨텍스트 스위칭이 필요한 이유

<br>

- CPU는 한 번에 하나의 프로세스만 수행 가능
- 여러개의 프로세스를 동시해 수행하려고 할 때, 동시에 수행하는 것처럼 보이게 하기 위해 **여러 개의 프로세스를 번갈아가며 수행**
- CPU가 프로세스를 바꿔가며 실행하기 위해서는 Context Switching 필요!

<br>

### 컨텍스트 스위칭 실행 과정

<br>

1. Process P1이 실행되는 도중 `인터럽트` 나 `시스템 콜`이 발생
2. Process P1의 프로그램 카운터 및 처리기 레지스터들(문맥 데이터)의 현재 값을 해당 프로세스 제어블록(PCB)의 적절한 필드에 저장
3. Process P1의 상태가 등록 또는 준비 등의 값으로 변경됨
4. 운영체제는 수행할 Process P2를 '수행' 상태로 만듦
5. Process P2의 프로그램 카운터와 문맥 데이터를 처리기 레지스터로 적재 => 수행!

<br>
=> 이렇게 프로세스가 바뀌는 과정을 `컨텍스트 스위칭`이라고 한다.<br>
=> 이 과정에서 프로세스가 실행하기 전까지 기다리는 시간, 메모리를 `오버헤드` 라고 한다.

<br>

### 컨텍스트 스위칭은 언제 발생하는가?

<br>

- CPU 스케쥴링에 의해 할당된 작업시간이 끝나 timeout 발생했을 시
- 프로세스의 작업이 끝났을 때
- 실행중인 프로세스가 입출력 요청할 시

<br>

## D. 참고자료

🔗 https://junsangkwon.tistory.com/45

📚 William Stallings, 『운영체제 내부구조 및 설계 8판』, 전광일 외 12명 공동역자, 프로텍 미디어(2015), P.118-119
