# 💡 Index(인덱스)

## 개념

![image](https://user-images.githubusercontent.com/75151848/192077361-93afa6aa-c523-4a37-ae8c-e43e24cc70ea.png)

추가적인 쓰기 작업과 저장 공간을 활용하여 데이터베이스 테이블의 검색 속도를 향상시키기 위한 자료구조.

테이블의 컬럼을 색인화(따로 파일로 저장)하여 검색시 해당 테이블의 레코드를 full scan 하는게 아니라 색인화 되어있는 index 파일을 검색하여 성능을 향상시킨다.

index는 트리 구조로 색인화하며, RDBMS에서는 index로 Balance Search Tree를 사용한다. <br/>
실제로는 RDBMS 에서 사용되는 B-Tree 는 B-Tree 에서 파생된 `B+ Tree` 를 사용한다.

<br/>

## 파일 구성

테이블 생성 시, 3가지 파일이 생성된다.

- FRM : 테이블 구조 저장 파일
- MYD : 실제 데이터 파일
- MYI : index 정보 파일 (index 사용 시 생성)

사용자가 쿼리를 통해 index를 사용하는 칼럼을 검색하게 되면, 이때 MYI 파일의 내용을 활용한다.

<br/>

## 장점

- 키 값을 기초로 하여 테이블에서 검색과 정렬 속도를 향상시킨다.
- 전반적인 시스템의 부하를 줄일 수 있다.
- 인덱스를 사용하면 테이블 행의 고유성을 강화시킬 수 있다.
- 여러 필드로 이루어진(다중 필드) 인덱스를 사용하면 첫 필드 값이 같은 레코드도 구분할 수 있다. <br/>
  (참고로 액세스에서 다중 필드 인덱스는 최대 10개의 필드를 포함할 수 있다.)
  
<br/>

## 단점

- 인덱스를 관리하기 위해 DB의 약 10%에 해당하는 저장공간이 필요하다.
- 인덱스를 관리하기 위해 추가 작업이 필요하다.
- 인덱스된 필드에서 데이터를 업데이트하거나, 레코드를 추가 또는 삭제 시 성능이 떨어진다.
- 데이터 변경 작업이 자주 일어나는 경우, index를 재작성해야 하므로 성능에 영향을 미친다.

<br/>

## DML 취약성

### 1. Insert

`index split` 현상이 발생할 수 있다. 
- 인덱스의 Block들이 하나에서 두 개로 나누어지는 현상
- 기존 Block에 여유가 없을 때, 새로운 데이터가 입력된 경우, 기존 블록의 내용 중 일부를 새 블록에 기록한 후 기존 블록에 빈 공간을 만들어서 새로운 데이터를 추가하게 된다.
- 성능면에서 불리한 점
  1. 새로운 블록을 할당 받고 key를 옮기는 복잡한 작업을 수행하며, 모든 수행 과정이 Redo에 기록되어 많은 양의 Redo를 유발한다.
  2. index split이 이루어지는 동안 해당 블록에 대해 키 값이 변경되면 안되므로 DML이 블로킹된다. (대기 이벤트 발생)

### 2. Delete

테이블에서 데이터가 delete 되는 경우, 데이터가 지워지고 다른 데이터가 그 공간을 사용 가능하다. <br/>
반면, index에서 데이터가 delete 되는 경우, 데이터가 지워지지 않고, 사용 안 됨 표시만 해둔다.

테이블의 데이터 개수보다 인덱스의 데이터 개수가 더 많은 경우, 성능 향상을 기대하기 힘들 수 있다.

### 3. Update

index에는 update 개념이 없다.

테이블에 update가 발생할 경우 index에서는 delete가 먼저 발생한 후 새로운 작업의 insert 작업이 발생한다. 

delete와 insert 두 개의 작업이 index에 동시에 일어나 다른 DML보다 더 큰 부하를 주게 된다.

<br/>

## Q. 인덱스는 언제 사용하는 것이 좋을까?

### 사용하면 좋은 경우

1. Where 절에서 자주 사용되는 Column
2. 외래키가 사용되는 Column
3. Join에 자주 사용되는 Column
4. INSERT, UPDATE, DELETE가 자주 발생하지 않는 컬럼
5. 데이터의 중복도가 낮은 컬럼

### 사용을 피해야 하는 경우

1. Data 중복도가 높은 Column
2. DML이 자주 일어나는 Column

<br/><br/>

> ### 🔖 참고
> - https://lalwr.blogspot.com/2016/02/db-index.html
> - https://mangkyu.tistory.com/96

