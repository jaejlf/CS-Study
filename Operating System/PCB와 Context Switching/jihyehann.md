# 💡 PCB & Context Switching

## PCB (Process Control Block)

### 1) PCB 란?

PCB(Process Control Block, 프로세스 제어 블록)는 특정 프로세스의 메타 데이터를 저장하는 운영체제 커널의 자료구조를 말한다.

운영체제에서 프로세스는 PCB로 나타내어지고, 각 프로세스는 고유한 PCB를 가진다.

PCB는 프로세스가 생성될 때마다 메모리에 생성되고, 프로세스가 완료되면 제거된다.

<br/>

> #### 🔖 PCB는 어떻게 관리될까?
> `Linked List` 방식으로 관리된다.
> 
> PCB가 생성될 때마다 PCB List Head에 붙는다. 주소값으로 연결되어 있는 연결리스트이기 때문에 삽입과 삭제가 용이하다.
> 
> 프로세스가 생성되면 해당 PCB가 생성되고 프로세스 완료 시 제거된다.

<br/>

PCB는 `프로세스 상태 관리`와 `문맥 교환(Context Switching)`을 위해 필요하다.

<br/>


### 2) 포함 정보
운영체제에 따라 PCB에 포함되는 항목이 다를 수 있지만, 일반적으로 다음과 같은 정보가 포함되어 있다.
  - **PID (Process ID)**: 프로세스의 고유 번호
  - **프로세스 상태 (Process State)**: 생성(create), 준비(ready), 실행    (running), 대기(waiting), 완료(terminated) 상태
  - **PC (Program Counter)**: 해당 프로세스가 다음에 실행할 명령어의 주소를 가리킨다.
  - **CPU 레지스터 및 일반 레지스터**
  - **CPU 스케줄링 정보**: 우선 순위, 최종 실행시각, CPU 점유시간 등
  - **메모리 관리 정보**: 해당 프로세스의 주소 공간 등
  - **프로세스 계정 정보** : 페이지 테이블, 스케줄링 큐 포인터, 소유자, 부모 등
  - **입출력 상태 정보** : 프로세스에 할당된 입출력장치 목록, 열린 파일 목록 등
  - **포인터** : 부모 프로세스에 대한 포인터, 자식 프로세스에 대한 포인터, 프로세스가 위치한 메모리 주소에 대한 포인터, 할당된 자원에 대한 포인터 정보 등

<br/>

### 3) PCB의 위치
PCB는 프로세스의 중요한 정보를 포함하고 있기 때문에, 일반 사용자가 접근하지 못하도록 보호된 메모리 영역 안에 남는다. 
일부 운영 체제에서 PCB는 커널 스택의 처음에 위치한다 (이 메모리 영역은 편리하면서도 보호를 받는 위치이기 때문이다).

<br/>

## Context Switching

### 1) Context Switching 이란?

Context Switching(문맥 교환)은 하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위해, 이전의 프로세스의 상태(문맥)를 보관하고 새로운 프로세스의 상태를 적재하는 작업을 말한다. 

이때 한 프로세스의 문맥은 그 프로세스의 프로세스 제어 블록(PCB)에 저장되어 있다.

<br/>

### 2) 발생 시점

문맥 교환은 다음과 같은 시점에 발생한다.

- 멀티 태스킹
- 인터럽트 핸들링
- 사용자 모드와 커널 모드 간 전환

<br/>

### 3) 오버헤드

문맥 교환 시 다음과 같은 오버헤드가 발생한다.
- Cache 초기화, Memory Mapping 초기화 등 무거운 작업들을 수행한다.
- CPU는 문맥 교환 동안 아무런 작업도 할 수 없다.

이러한 오버헤드로 인해 잦은 문맥 교환은 성능 저하를 가져올 수 있다.

<br/>

### 4) 프로세스 vs 스레드

자세한 내용은 [여기](https://github.com/jaejlf/CS-Study/blob/main/Operating%20System/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%20vs%20%EC%8A%A4%EB%A0%88%EB%93%9C/jihyehann.md)를 참고하자

#### 프로세스의 문맥 교환
- 프로세스끼리는 공유하는 데이터가 없으므로 임시 저장소인 캐시 메모리가 지금껏 쌓아놓은 데이터들이 사라지고 새로 데이터를 쌓아야 한다.

#### 스레드의 문맥 교환
- 스레드는 스택(Stack)을 제외한 코드(Code), 데이터(Data), 힙(Heap) 영역을 공유하므로, 문맥 교환 시 스택 및 간단한 정보만 저장하면 된다.
- 프로세스의 문맥 교환보다 빠르다.
- 따라서 콘텍스트 스위칭의 오버헤드를 개선하기 위해 스레드 컨텍스트 스위칭을 사용하기도 한다.



<br/>

## 🔖 참고
- https://yoongrammer.tistory.com/52
- https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D
- https://beststar-1.tistory.com/26

