# 💡 메모리 

### 1. Main Memory

- 실행될 프로그램을 위한 적재 장소.
- 프로그램이 실행되기 위해서는 메모리에 올라와야 하며, 메모리에 올라가 실행 중인 프로그램을 프로세스라고 한다.
- 메모리 주소는 일련의 바이트들로 구성되어 있다.

<br/>

### 2. MMU (Memory Management Unit, 메모리 관리 장치)

![](https://velog.velcdn.com/images/wisdom-one/post/0360ca4a-bb6c-4af0-9bbb-a781cbe8d858/image.png)

- 논리 주소를 물리 주소로 변환해준다.
- 메모리 보호나 캐시 관리 등 CPU가 메모리에 접근하는 것을 총 관리해주는 하드웨어다.
- CPU는 명령어 수행 시, 필요한 데이터를 메모리로부터 가져오는데, 이때 MMU를 사용한다.

<br/>

#### 1) 주요 기능

|기능|설명|
--|--
주소 변환 | 가상메모리 주소를 물리 주소로 변환
특권 통제 |	 사용자 프로그램에서 커널 영역 침범 차단
캐시 통제 | 캐시 가능 영역과 불가 영역 설정
읽기/쓰기보호	| Read / Write 불가 영역 생성 기능
메모리 보호	| 각 프로세스 별 영역만 접근하도록 통제

<br/>

#### 2) 주소 변환 과정

![](https://velog.velcdn.com/images/wisdom-one/post/744f43b2-9015-43ce-af40-437541fda61f/image.png)

1. MMU에 가상주소 전달
2. Page Table 탐색
3. 물리주소 MMU에 전달
4. 주소신호(RAS,CAS) 발생
5. Data를 CPU에 전달

<br/>

#### 3) MMU의 메모리 보호

한 프로세스에게 합법적인 주소 영역을 설정하고, 잘못된 접근이 오면 trap을 발생시키며 보호한다.

**base와 limit 레지스터를 활용한 메모리 보호 기법**

- `base` 레지스터는 메모리상의 프로세스 시작주소를 물리 주소로 저장한다. 
- `limit` 레지스터는 프로세스의 사이즈를 저장한다.
- 프로세스의 접근 가능한 합법적인 메모리 영역(x) : `base <= x < base+limit`
- 합법적인 메모리 영역 밖에서 접근을 요구하면 trap을 발생시킨다.

안전성을 위해 base와 limit 레지스터는 커널 모드에서만 수정 가능하도록 설계한다. 따라서 사용자 모드에서는 직접 변경할 수 없다.

<br/>

### 3. 캐시 메모리

- 주기억장치에 저장된 내용의 일부를 임시로 저장해두는 기억장치
- CPU와 주기억장치의 속도 차이로 성능 저하를 방지하기 위해 사용한다.
- CPU가 이미 봤던걸 다시 재접근할 때, 메모리 참조 및 인출 과정에 대한 비용을 줄이기 위해 캐시에 저장해둔 데이터를 활용한다.
- 플립플롭으로 구성된 SRAM으로 되어있어 DRAM(메인 메모리)보다 빠르다.

<br/>

#### 1) CPU와 상호작용

CPU에서 주소를 전달하여 캐시 기억장치에 명령이 존재하는지 확인한다.

해당 명령어가 캐시에 있으면 `Hit` : 캐시에서 CPU로 해당 명령어를 전송

캐시에 없으면 `miss` : 메인메모리 접근 → 해당 명령어를 가진 데이터 인출 → 해당 명령어 데이터를 캐시에 저장 → 해당 명령어를 CPU로 전송

<br/>

#### 2) 지역성

시간 지역성
- 최근에 참조된 주소의 내용은 곧 다음에도 참조되는 특성
- for나 while 같은 반복문에 사용하는 조건 변수처럼 한번 참조된 데이터는 잠시후 또 참조될 가능성이 높다.

공간 지역성
- 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성
- A[0], A[1]과 같은 연속 접근 시, 참조된 데이터 근처에 있는 데이터가 잠시후 또 사용될 가능성이 높다.

캐시에 데이터를 저장할 때는, 이러한 참조 지역성(공간)을 최대한 활용하기 위해 해당 데이터뿐만 아니라, 옆 주소의 데이터도 같이 가져와 미래에 쓰일 것을 대비한다.

<br/><br/>

[참고](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Memory.md)

[MMU 참고](http://blog.skby.net/mmu-memory-management-unit/)
