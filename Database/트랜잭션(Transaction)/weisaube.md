# 트랜젝션(Transaction)

## A. 트랜젝션이란?

> **데이터베이스의 상태를 변화시키기 위해 수행하는 작업 단위**

상태를 변화시킨다는 것은 **SQL 질의어를 통해 DB에 접근**하는 것을 말한다.

```sql
- SELECT
- INSERT
- DELETE
- UPDATE
```

작업 단위 → 많은 SQL 명령문들은 사람의 기준에 따라 정하는 것

<br/>

```sql
예시) 사용자 A가 사용자 B에게 만원을 송금한다.

* 이때 DB 작업
- 1. 사용자 A의 계좌에서 만원을 차감한다 : UPDATE 문을 사용해 사용자 A의 잔고를 변경
- 2. 사용자 B의 계좌에 만원을 추가한다 : UPDATE 문을 사용해 사용자 B의 잔고를 변경

현재 작업 단위 : 출금 UPDATE문 + 입금 UPDATE문
→ 이를 통틀어 하나의 트랜잭션이라고 한다.
- 위 두 쿼리문 모두 성공적으로 완료되어야만 "하나의 작업(트랜잭션)"이 완료되는 것이다. `Commit`
- 작업 단위에 속하는 쿼리 중 하나라도 실패하면 모든 쿼리문을 취소하고 이전 상태로 돌려놓아야한다. `Rollback`
```

<br/>

트랜잭션은 작업의 **완전성**을 보장해 준다.

즉, 위의 예시와 같이 논리적인 작업 단위를 모두 완벽하게 처리하거나 또는 처리하지 못할 경우에는 원 상태로 복구해서 작업의 일부만 적용되는 현상이 발생하지 않게 만들어 준다.

사용자의 입장에서는 작업의 논리적 단위로 이해를 할 수 있고 시스템의 입장에서는 데이터들을 접근 또는 변경하는 프로그램의 단위가 된다.

<br/>

트랜젝션의 4가지 원칙은 ACID로 설명할 수 있다.

- 원자성(**A**tomicity)

  > 트랜젝션이 DB에 모두 반영되거나, 혹은 전혀 반영되어야 하지 않아야 한다.

  위의 예시처럼 정의된 연산들(ex. 출금 UPDATE와 입금 UPDATE)가 모두 성공적으로 실행되던지 아니면 아예 실행하지 않은 상태로 남아야 된다.

    <br/>

- 일관성(**C**onsistency)

  > 트랜잭션의 작업 처리 결과는 항상 일관성 있어야 한다.

  트랜잭션이 완료된 다음의 상태에서도 **트랜잭션이 일어나기 전의 상황과 동일**하게 데이터의 일관성을 보장해야 한다. 예를 들면 데이터베이스에서 정한 무결성 제약 조건을 항상 만족해야 한다.

  은행 송금 기능을 생각해보면, 트랜잭션 수행 이전의 송금자와 수금자의 잔액 합이 수행 후에 달라지거나, 혹은 잔액을 나타내는 자료형이 정수형에서 문자열로 바뀌는 등의 모순이 발생하면 안 된다.

    <br/>


- 고립성(**I**solation)
  > 둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 때, 어떤 트랜잭션도 다른 트랜잭션 연산에 끼어들 수 없다.
  둘 이상의 트랜젝션이 병행 실행되고 있을 경우, 현 수행 중인 트랜젝션이 완료되기 전에 현재 트랜젝션이 생성한 중간 연산 결과를 다른 트랜젝션이 접근하면 안 된다.
  고립성을 통해 사용자들은 여러 트랜젝션이 동시에 수행되고 있는 것처럼 느끼면서도 정확한 결과를 얻을 수 있게 된다.

<br/>

- 지속성(**D**urability)

  > 트랜잭션이 성공적으로 완료되었으면, 결과는 영구적으로 반영되어야 한다.

  시스템에 장애가 발생하더라도 결과는 데이터베이스에 그대로 남아 있어야 하며, 지속성을 보장하기 위해서는 회복 기능이 필요하다.

<br/>

## B. 참고 자료

🔗 [[DB] 9. 트랜잭션(Transaction) - (1) 특성, ACID, 연산, 상태](https://rebro.kr/162)

🔗 [5. 트랜잭션과 잠금](https://jwkim96.tistory.com/264)

🔗 [db.md#트랜잭션이란](https://github.com/WeareSoft/tech-interview/blob/master/contents/db.md#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%B4%EB%9E%80)
