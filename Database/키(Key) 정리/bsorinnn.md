# 키(Key) 정리

**키(Key)란?**

> 릴레이션에서 튜플들을 유일하게 구별하는 속성 또는 속성들의 집합

<br>

- 기본키(Primary Key)
- 후보키(Candidate Key)
- 대체키(Alternate Key)
- 외래키(Foreign Key)
- 수퍼키(Super Key)

<br>

## A. 키의 특성

- 유일성(Uniqueness)
  - 하나의 릴레이션에서 **모든 튜플들은 서로 다른 키 값**을 가져야 합니다.
- 최소성(Minimality)
  - 꼭 필요한 최소한 속성들로만 키를 구성해야 합니다.

<br>

## B. 데이터베이스 키의 종류

<br>

#### 고객 릴레이션

| CustomerID | CustomerName                       | Address                       | City        |
| ---------- | ---------------------------------- | ----------------------------- | ----------- |
| 1          | Alfreds Futterkiste                | Obere Str. 57                 | Berlin      |
| 2          | Ana Trujillo Emparedados y helados | Avda. de la Constitución 2222 | México D.F. |
| 3          | Antonio Moreno Taquería            | Mataderos 2312                | México D.F. |

<br>

#### 주문 릴레이션

| OrderID | CustomerID | OrderDate  | ShipperID |
| ------- | ---------- | ---------- | --------- |
| 10308   | 1          | 1996-09-18 | 21        |
| 10309   | 3          | 1996-09-19 | 9         |
| 10310   | 2          | 1996-09-18 | 5         |

<br>

- 수퍼키(super key)

  - **유일성**을 만족하는 속성 또는 속성들의 집합
    => 식별이 가능하다는 것. 중복 없이 모든 키들이 각자의 값을 가진다<br>
    ex) 고객 릴레이션의 수퍼키 - 고객아이디 → 유일성, 최소성 만족 - (고객아이디, 고객 이름) → 유일성 만족, 최소성 불만족 - (고객 이름, 주소) → 유일성, 최소성 만족 - 두 개의 속성들로 수퍼키를 구성하는 것도 가능하다

- 후보키(Candidate Key)

  - **유일성과 최소성** 둘 다 만족하는 속성 또는 속성들의 집합
  - ex) 고객아이디, (고객 이름, 주소)
  - ❓ 왜 (고객아이디, 고객 이름)은 해당되지 않을까?
    - 이미 고객아이디로 구분 가능하기 때문에 고객 이름까지 넣는 것은 최소성 원칙 위배

- 기본키(primary key)

  - 후보키 중에서 기본적으로 사용하기 위해 선택한 키
  - NULL값을 가질 수 있는 후보키는 부적합
  - 값이 자주 변경될 수 있는 속성을 가진 후보키는 부적합
  - 단순한 후보키를 선택
  - ex) 고객 릴레이션의 후보키 중 기본키 선택
    - (1) 고객아이디 → 최대한 단순! ✅
    - (2) (고객이름, 주소) → 주소가 NULL 값을 가질 수 있다면 부적합. 그리고 주소의 경우 이사하면 값이 변경될 수 있는 속성을 가지고 있기 때문에 부적합 ❌

- 대체키(alternate key)

  - 기본키로 선택되지 못한 후보키
  - ex) 고객 릴레이션의 (고객이름, 주소)

- 외래키(foreign key)

  - 다른 릴레이션의 기본키를 참조하는 속성 또는 속성들의 집합
  - 릴레이션들 간의 관계를 표현

    - 참조하는 릴레이션: 외래키가 가진 릴레이션(주문 릴레이션)
    - 참조되는 릴레이션: 외래키가 참조하는 기본키를 가진 릴레이션(고객 릴레이션)

    - 고객 릴레이션의 기본키인 고객아이디(CustomerID)는 주문 릴레이션의 외래키다.

  - 역할: 두 릴레이션이 관계를 맺어 연관성 있는 투플을 연결할 수 있도록 한다
  - 외래키 속성과 그것이 참조하는 기본키 속성의 이름은 달라도 되나 도메인은 같아야 한다
    - ex) 고객 릴레이션에서는 `고객 아이디`지만, 주문 릴레이션에서 외래키로 쓰일 때는 `주문고객`이란 이름으로 쓰일 수 있다.<br> 단, 이때 도메인은 둘다 INTEGER로 같아야 한다<br>
  - 하나의 릴레이션에는 외래키가 여러 개 존재할 수 있고, 외래키를 기본키로 사용할 수도 있다
    - ex) 상담 릴레이션의 외래키로는 학생 릴레이션의 기본키인 학번과 교사 릴레이션의 기본키인 교사번호, 이렇게 두 개의 외래키를 가질 수 있다. <br>
      그리고 상담 릴레이션은 (학번, 교사번호)를 기본키로 사용할 수 있다.
  - 같은 릴레이션의 기본키를 참조하는 외래키도 정의할 수 있다
    - ex) 고객 릴레이션에서 `추천 고객` 있을 경우 순환 관계가 생길 수 있다. <br>이때 `추천 고객`은 외래키가 되고 이는 고객아이디라는 기본키를 선택한다

## C. 무결성 제약조건(integrity constraint)

> 데이터의 무결성을 보장하고 일관된 상태로 유지하기 위한 조건

- 무결성: 데이터를 결함이 없는 상태, 즉 정확하고 유효하게 유지하는 것

### 무결성 제약 조건의 종류

- 개체 무결성 제약 조건(entity integrity constraint)
  - 기본키를 구성하는 모든 속성들은 NULL 값을 가질 수 없다
- 참조 무결성 제약 조건(referential integrity constraint)
  - 외래키는 참조할 수 없는 값을 가질 수 없다
    - ex) 고객 릴레이션의 고객 아이디에는 10382이 없는데 주문 릴레이션에서 주문 고객으로 10382를 참조할 수 없다
  - 단, 외래키가 NULL 값을 가진다 해서 참조 무결성 조건을 위배한 것은 아니다.

## D. 참고자료

📼 데이터베이스의 원리와 응용 - 한양대학교, 백현미 교수님
