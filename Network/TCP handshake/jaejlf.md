# 📍 Handshake

- 상대방과 연결 상태를 생성하고, 해제하기 위해 거치는 과정
- **3-way Handshake** : 연결을 생성하는 과정
- **4-way Handshake** : 연결을 해제하는 과정

<br><br>

# 📍 TCP 3-way Handshake

- TCP 통신을 이용하여 데이터를 전송하기 위해 연결을 생성하는 과정
- 본격적으로 연결을 맺기 전, 서로 TCP 연결을 요청/수락하는 준비 과정

<br>

## 과정

![image](https://user-images.githubusercontent.com/78673570/184526650-4a9c69c7-0e21-479e-91fd-37004407e3cf.png)

\# **CLOSED** - 아무런 연결도 없는 상태

\# **LISTEN** - 서버가 연결 요청을 기다리고 있는 상태


1️⃣ **SYN** - 클라이언트가 서버에 접속을 요청하는 `SYN 패킷` 전송

2️⃣ **ACK + SYN** - 요청을 받은 서버는 접속을 수락한다는 `ACK 패킷`과, `SYN 패킷` 전송

3️⃣ **ACK** - 서버로부터 연결 수락을 받은 클라이언트는 서버에게 최종적으로 `ACK 패킷` 전송

\# **ESTABLISHED** - 서버는 클라이언트로부터 받은 `ACK 패킷`을 확인 후, 문제가 없다고 판단되면 `ESTABLISHED` 상태로 들어감.

<br>

=> 여기까지의 과정이 완료되면, 클라이언트와 서버는 안전하고 신뢰성있는 연결이 생성되었다고 판단하여 본격적인 통신을 시작할 수 있다.


<br><br>

# 📍 TCP 4-way Handshake

- 연결을 해제하는 과정
- 한 쪽에서 일방적으로 연결을 끊어버리면, 다른 한 쪽은 연결이 끊어졌는지 알 방법이 없기 때문에 양 쪽이 다 정상적으로 연결을 종료할 준비가 되었는지 확인하는 과정

<br>

## 과정

![image](https://user-images.githubusercontent.com/78673570/184526806-d8fb3d29-17b6-4ba3-9a0a-dba73b27c67e.png)

\# **ESTABLISHED** - 클라이언트와 서버가 연결되어있는 상태

1️⃣ **FIN** - 클라이언트가 서버에게 연결 해제를 요청하는 `FIN 패킷` 전송

2️⃣ **ACK**

- 서버의 **CLOSED_WAIT** - 요청을 받은 서버는 확인했다는 `ACK 패킷`을 전송하고, 남은 데이터가 있다면 마저 전송
- 클라이언트의 **FIN_WAIT_2** - 서버로부터 받은 `ACK 패킷`을 확인하고, 서버가 남은 데이터 처리를 끝내고 연결 종료를 수락하는 `FIN 패킷`을 보내줄 때까지 대기

3️⃣ **FIN** - 서버가 남은 데이터 처리를 끝냈다면, 연결 종료를 수락하는 `FIN 패킷`을 전송

4️⃣ **ACK** - 클라이언트는 `FIN 패킷`을 받고, 서버에게 확인했다는 `ACK 패킷`을 전송하고, `TIME_WAIT` 상태로 기다린다.

\# **CLOSED** - 서버는 `ACK 패킷`을 전달받은 이후 연결을 닫는다.

\# **CLOSED** - `TIME_WAIT` 시간이 끝나면 클라이언트도 연결을 닫는다.
