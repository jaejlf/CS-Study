# 저장 프로시져(Stored PROCEDURE)

## 📌 A. 저장 프로시져

> 일련의 쿼리를 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합

DB에 대해 작업을 정리한 절차를 RDBMS에 저장한 쿼리의 집합<br/>
(여러 쿼리를 하나의 함수로 묶은 것)

<br/>

- SQL Server에서 제공되는 프로그래밍 기능. 쿼리문의 집합
- 어떠한 동작을 일괄 처리하기 위한 용도로 사용.
- 자주 사용되는 일반적인 쿼리를 모듈화시켜서 필요할 때마다 호출
- 테이블처럼 각 데이터베이스 내부에 저장

<br/>

## 📌 B. 일반 쿼리문 vs 저장 프로시져

### 일반 쿼리문

일반 쿼리문의 경우 **'파싱 → 최적화 → 컴파일 및 실행계획 등록(실행계획 결과를 메모리에 등록) → 실행’** 의 단계를 거침

👉 최적화된 결과를 바탕으로 컴파일 및 실행 계획 등록 단계에서 해당 실행계획 결과를 메모리(캐시)에 등록

<br/>

### 저장 프로시져

#### 1. 저장 프로시져의 정의 단계

<br/>

1. 구문 분석
   - 구문의 오류 파악
2. 지연된 이름 확인
   - 저장 프로시져를 정하는 시점에서 해당 개체(ex. 테이블)이 존재하지 않아도 상관 없다. 프로시져 실행 당시에 테이블의 존재 여부를 확인한다(개체이름 확인)
3. 생성 권한 확인
   - 현재 사용자가 저장 프로시져를 생성할 권한이 있는지 확인
4. 시스템 테이블 등록
   - 저장 프로시져의 이름 및 코드가 시스템 테이블에 등록

<br/>

#### 2. 저장 프로시져 최초 실행 단계

<br/>

저장 프로시져의 경우 **'개체 이름 확인 → 사용한 확인 → 최적화 → 컴파일 및 실행계획 등록 → 실행’** 의 단계를 거침

- 저장프로시저 정의 단계의 지연된 이름확인에서 미루어두었던 해당 개체 존재 유무를 개체 이름 확인을 통해 수행

<br/>

#### 3. 그 이후 저장 프로시져 실행 단계

<br/>

두번째 실행 부터는 메모리(캐시)에 있는 것을 그대로 가져와 재사용하게 되어 수행시간을 단축

<br/>

## 📌 C. 저장 프로시져의 장단점

### 장점

- SQL 서버의 성능 향상 가능
  - 두번째 실행부터는 캐시(메모리)에 있는 것을 가져와서 사용하므로 속도가 빨라짐
  - 여러 개의 쿼리를 한번에 실행할 수 있음
- 유지 보수 및 재활용 측면에서 좋음
  - 수정요건이 발생 시 코드 내 SQL문을 건드리는게 아니라 SP 파일만 수정하면 됨
  - 저장 프로시저를 생성해 놓으면, 언제든 실행이 가능하다는 장점 존재
- 보안을 강화할 수 있다 - 권한 체계
  - 사용자별로 테이블에 권한을 주는게 아닌 저장 프로시저에만 접근 권한을 줌으로써 테이블의 모든 정보를 사용자에게 노출하지 않고 프로시저에서 선택한 정보만 사용자에게 보여줄 수 있음
- 네트워크의 부하(전송량)를 줄일 수 있다
  - 클라이언트에서 서버로 쿼리의 모든 텍스트가 전송될 경우 네트워크에는 큰 부하가 발생지만 하지만 저장 프로시저를 이용한다면 저장 프로시저의 이름, 매개변수 등 몇글자만 전송하면 되기 때문에 부하를 크게 줄일 수 있음

<br/>

### 단점

- DB 확장 어려움
- 데이터 분석의 어려움
- 낮은 처리 성능

<br/>

## D. 참고자료

🔗 [저장 프로시져](https://velog.io/@sweet_sumin/%EC%A0%80%EC%9E%A5-%ED%94%84%EB%A1%9C%EC%8B%9C%EC%A0%80-Stored-Procedure)
